name: Auto-format Merge Commit

on:
    pull_request:
        types: [closed]

jobs:
    format-merge:
        if: github.event.pull_request.merged == true
        runs-on: ubuntu-latest
        permissions:
            issues: write
            pull-requests: write

        steps:
            - name: Add merge comment
              uses: actions/github-script@v7
              with:
                  script: |
                      const prTitle = context.payload.pull_request.title;

                      const titleWithoutType = prTitle.replace(/^(feat|fix|docs|bugfix|refactor):\s*/, '');
                      const mergeTitle = `Merge: ${prTitle}`;

                      await github.rest.issues.createComment({
                        issue_number: context.payload.pull_request.number,
                        owner: context.repo.owner,
                        repo: context.repo.repo,
                        body: `âœ… **Merged successfully**\n\nMerge commit title: \`${mergeTitle}\``
                      });
